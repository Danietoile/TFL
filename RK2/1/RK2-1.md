# RK2 — Задание 1

## Условие

Дана КС-грамматика над алфавитом $\Sigma=\{a,b\}$:

$$
S \to bSaSb \mid SaSa \mid a.
$$

Пусть $L_0=L(G)$ — язык, порождённый грамматикой из стартового нетерминала $S$.

Для слова $w$ определим:

- $M_a(w)$ — длина максимального подслова вида $a^+$ (непустой блок подряд идущих $a$);
- $M_{ba}(w)$ — длина максимального подслова вида $(ba)^+$ (непустой блок строгого чередования $ba,ba,\dots$).

Требуется рассмотреть язык

$$
L=\{\,w\in L_0 \mid M_{ba}(w)<M_a(w)\,\}.
$$

---

## 1) Базовый язык $L_0$ и простые свойства

Грамматика задаёт наименьшее множество строк $L_0\subseteq\{a,b\}^*$, такое что:

1) $a\in L_0$;

2) если $x,y\in L_0$, то
- $b\,x\,a\,y\,b\in L_0$ (правило $S\to bSaSb$);
- $x\,a\,y\,a\in L_0$ (правило $S\to SaSa$).

Полезный инвариант по числу символов $b$:

**Лемма 1.** Для любого $w\in L_0$ число символов $b$ в $w$ чётно.

*Доказательство.* В базе $w=a$ имеем $0$ символов $b$ (чётно). Правило $SaSa$ не добавляет $b$, правило $bSaSb$ добавляет ровно $2$ символа $b$. Индукция по длине вывода. $\square$

Также заметим структурный факт:

**Лемма 2.** Если слово $w\in L_0$ оканчивается на $b$, то в его выводе в корне обязательно применено правило $S\to bSaSb$, то есть
$$
w=b\,x\,a\,y\,b,\quad x,y\in L_0.
$$

*Доказательство.* Правила $S\to a$ и $S\to SaSa$ всегда дают слово, оканчивающееся на $a$. Единственное правило, дающее на конце $b$, — $S\to bSaSb$. $\square$

---

## 2) Выбор регулярного языка $R$

Рассмотрим регулярный язык
$$
R=b^+\,aaab\,(aab)^*.
$$

Он регулярный, так как задаётся регулярным выражением.

Ключевое наблюдение: для любого $w\in R$ автоматически выполняется ограничение $M_{ba}(w)<M_a(w)$.

**Лемма 3.** Для любого $w\in R$ выполнено $M_a(w)=3$ и $M_{ba}(w)=2$.

*Доказательство.* После начального блока $b^+$ в $R$ обязательно стоит фрагмент $aaab$, то есть в слове есть подслово $aaa$, поэтому $M_a(w)\ge 3$.
С другой стороны, далее встречаются только блоки $aab$. Внутри $aaab(aab)^*$ нигде не возникает $aaaa$, значит максимальный блок подряд идущих $a$ имеет длину ровно $3$: $M_a(w)=3$.

Любое вхождение $ba$ в слове из $R$ (и на границе $b^+|aaab$, и в блоках $aab$) немедленно продолжается как $baa\ldots$, поэтому строгое чередование $ba\,ba\,\dots$ обрывается на второй позиции: максимальная длина подслова вида $(ba)^+$ равна $2$. Значит $M_{ba}(w)=2$. $\square$

Из леммы 3 следует:
$$
R \subseteq \{\,w \mid M_{ba}(w)<M_a(w)\,\},
$$
поэтому
$$
L\cap R = L_0\cap R.
$$

---

## 3) Описание $L_0\cap R$

Определим семейство слов $\{w_n\}_{n\ge 1}$:

$$
w_1=baaab,\qquad
w_{n+1}=b\,w_n\,aa\,b \quad (n\ge 1).
$$

### 3.1) Включение $\{w_n\}\subseteq L_0\cap R$

**Лемма 4.** Для всех $n\ge 1$ слово $w_n\in L_0$.

*Доказательство.* База: $w_1=baaab$ выводится так:
$$
S \Rightarrow bSaSb \Rightarrow b\,a\,a\,a\,b.
$$
Переход: если $w_n\in L_0$, то по правилу $S\to bSaSb$ при левом $S\Rightarrow w_n$ и правом $S\Rightarrow a$ получаем
$$
S \Rightarrow bSaSb \Rightarrow b\,w_n\,a\,a\,b = w_{n+1}.
$$
Индукция. $\square$

**Лемма 5.** Для всех $n\ge 1$ верна формула
$$
w_n=b^n\,aaab\,(aab)^{n-1},
$$
и, следовательно, $w_n\in R$.

*Доказательство.* Индукция по $n$. База $n=1$: $w_1=baaab=b^1 aaab (aab)^0$.
Переход:
$$
w_{n+1}=b\,w_n\,aa\,b = b\cdot\bigl(b^n aaab (aab)^{n-1}\bigr)\cdot aa b
= b^{n+1} aaab (aab)^n.
$$
$\square$

Из лемм 4 и 5 получаем $w_n\in L_0\cap R$ для всех $n\ge 1$, то есть $\{w_n\}\subseteq L_0\cap R$.

---

### 3.2) Включение $L_0\cap R \subseteq \{w_n\}$

Пусть $w\in L_0\cap R$. Тогда существует представление
$$
w=b^n\,aaab\,(aab)^k,\quad n\ge 1,\ k\ge 0.
$$
В частности, $w$ оканчивается на $b$, и по лемме 2:
$$
w=b\,x\,a\,y\,b,\quad x,y\in L_0.
$$

Так как $w\in R$, суффикс слова имеет вид $aab$ (последние три символа), то есть непосредственно перед последним $b$ стоят ровно два символа $a$.

В разложении $w=b\,x\,a\,y\,b$ символы перед последним $b$ образуют конец строки $a\,y$.
Чтобы последние два символа перед финальным $b$ были равны $aa$, центральный $a$ (вставленный правилом $bSaSb$) должен быть предпоследним $a$, а последний $a$ должен быть первым (и единственным) символом, порождённым $y$. Иначе центральный $a$ располагался бы левее двух последних $a$, что несовместимо с фиксированным окончанием $aab$ языка $R$.

Следовательно,
$$
y=a,
$$
и потому
$$
w=b\,x\,aa\,b.
$$

Сравнивая с формой $w=b^n aaab (aab)^k$, видим, что хвост $aa\,b$ — это ровно один последний блок $aab$. Значит
$$
x=b^{n-1}\,aaab\,(aab)^{k-1}.
$$
При этом $x\in L_0$ (так как $x$ порождён нетерминалом $S$), и, очевидно, $x\in R$ при $k\ge 1$. Значит $x\in L_0\cap R$.

Итак, получена редукция:
$$
w\in L_0\cap R,\ w=b^n aaab (aab)^k
\ \Longrightarrow\
x\in L_0\cap R,\ x=b^{n-1} aaab (aab)^{k-1}.
$$

Повторяя её $n-1$ раз, приходим к случаю с одним ведущим $b$, то есть к слову вида
$$
b\,aaab\,(aab)^{k-(n-1)}.
$$
Но в $L_0\cap R$ при одном ведущем $b$ возможно только базовое слово $w_1=baaab$, откуда следует
$$
k-(n-1)=0 \quad\Rightarrow\quad k=n-1,
$$
и
$$
w=b^n\,aaab\,(aab)^{n-1}=w_n.
$$

Тем самым доказано:
$$
L_0\cap R=\{\,w_n \mid n\ge 1\,\}=\{\,b^n\,aaab\,(aab)^{n-1}\mid n\ge 1\,\}.
$$

С учётом пункта 2:
$$
L\cap R=L_0\cap R=\{\,b^n\,aaab\,(aab)^{n-1}\mid n\ge 1\,\}.
$$

---

## 4) Нерегулярность $L$

Обозначим
$$
W=L\cap R=\{\,b^n\,aaab\,(aab)^{n-1}\mid n\ge 1\,\}.
$$

Докажем, что $W$ не регулярен (лемма о накачке для регулярных языков).

Пусть $W$ регулярен. Тогда существует длина накачки $p$.
Рассмотрим слово
$$
w=b^p\,aaab\,(aab)^{p-1}\in W.
$$
По лемме о накачке существует разбиение $w=xyz$ такое, что:
- $|xy|\le p$,
- $|y|>0$,
- $xy^iz\in W$ для всех $i\ge 0$.

Так как первые $p$ символов $w$ — это только $b$, имеем $y=b^t$ для некоторого $t\ge 1$.
Возьмём $i=0$. Тогда
$$
xz=b^{p-t}\,aaab\,(aab)^{p-1}.
$$
В словах языка $W$ число ведущих $b$ равно числу блоков $(aab)$ плюс $1$.
Здесь блоков $(aab)$ осталось $p-1$, а ведущих $b$ стало $p-t$. Для принадлежности $xz$ языку $W$ должно было бы выполняться
$$
p-t=(p-1)+1=p,
$$
что невозможно при $t\ge 1$. Значит $xz\notin W$, противоречие лемме о накачке.

Следовательно, $W$ не регулярен.

Но $R$ регулярен и если бы $L$ был регулярен, то $L\cap R$ тоже был бы регулярен (замкнутость регулярных языков относительно пересечения). Получаем противоречие, значит:

$$
\boxed{\text{Язык }L\text{ не является регулярным.}}
$$
