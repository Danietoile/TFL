# Вариант 6 — Задача 3 (атрибутная грамматика)

## Условие

Дана атрибутная грамматика над алфавитом $\Sigma=\{a,b\}$:

```text
S -> SS      ;   S0.attr == S1.attr  OR  S0.attr == S2.attr
S -> bTb     ;   S.attr := T.attr + 1

T -> aT      ;   T0.attr := T1.attr - 1
T -> bTb     ;   T0.attr := T1.attr + 1
T -> ε       ;   T.attr := 0
```

Требуется:

1. определить язык $L$, задаваемый этой атрибутной грамматикой;
2. проверить $L$ на контекстно-свободность;
3. проверить $L$ на регулярность (если не регулярный — доказать).

---

## 1) Язык, задаваемый атрибутной грамматикой

### 1.1. Атрибуты и влияние предикатов

Для нетерминала $T$ атрибут $T.attr$ синтезируемый и однозначно вычисляется по дереву вывода:

- $T\to\varepsilon$: $T.attr=0$;
- $T\to aT$: $T_0.attr=T_1.attr-1$;
- $T\to bTb$: $T_0.attr=T_1.attr+1$.

Для правила $S\to bTb$ также однозначно:

```math
S.attr = T.attr + 1.
```

Единственное “ограничительное” место — правило конкатенации

```math
S\to SS;\qquad S_0.attr = S_1.attr \ \vee\ S_0.attr = S_2.attr.
```

Оно **не требует** равенства $S_1.attr=S_2.attr$: достаточно, чтобы атрибут родителя совпал с атрибутом **одного** из потомков.

При семантике “существует атрибутация, удовлетворяющая предикатам” это условие не ограничивает множество выводимых терминальных строк: в каждой вершине $S\to SS$ можно выбрать $S_0.attr$ равным $S_1.attr$ или $S_2.attr$.

Следовательно, язык атрибутной грамматики совпадает с языком её КС-скелета.

---

### 1.2. КС-скелет и описание языка

Скелетная (обычная КС) грамматика:

```math
S \to SS \mid bTb,\qquad T \to aT \mid bTb \mid \varepsilon.
```

Обозначим $L_T=L(T)$. Тогда $L_T$ — наименьший язык, такой что:

- $\varepsilon\in L_T$;
- если $w\in L_T$, то $aw\in L_T$;
- если $w\in L_T$, то $bwb\in L_T$.

То есть $L_T$ замкнут относительно операций “приписать $a$ слева” и “обернуть $b\ldots b$”.

Из правила правила $S\to SS$ следует, что $S$ порождает конкатенации блоков вида $bwb$, где $w\in L_T$. Поскольку правила $S\to\varepsilon$ нет, блоков как минимум один.

Итак,

```math
\boxed{\,L=L(S)=\bigl(b\,L_T\,b\bigr)^+\,}.
```

---

## 2) Контекстно-свободность

Язык $L$ порождается контекстно-свободной грамматикой

```math
S \to SS \mid bTb,\qquad T \to aT \mid bTb \mid \varepsilon,
```

следовательно,

```math
\boxed{\,L\ \text{контекстно-свободный.}\,}
```

---

## 3) Регулярность

Докажем, что $L$ **не регулярный**.

### 3.1. Регулярное пересечение

Рассмотрим регулярный язык

```math
R=(ba)^+\,b^+,
```

то есть слова вида $(ba)^m b^k$, где $m\ge 1$ и $k\ge 1$.

Если бы $L$ был регулярным, то $L\cap R$ тоже был бы регулярным (регулярные языки замкнуты относительно пересечения). Покажем, что $L\cap R$ нерегулярен.

---

### 3.2. Характеризация $L\cap R$

Обозначим

```math
U=\\{(ba)^m\,b^{m+2t}\mid m\ge 1,\ t\ge 0\\}.
```

Утверждение:

```math
\boxed{\,L\cap R = U.\,}
```

#### (⊇) Включение $U\subseteq L\cap R$

Возьмём $m\ge 1$, $t\ge 0$ и слово

```math
w=(ba)^m b^{m+2t}.
```

Очевидно, $w\in R$.

Покажем, что $w\in L$. Достаточно вывести $w$ по правилу $S\to bTb$, то есть построить $x\in L_T$ такое, что $w=bxb$.
Положим

```math
x = a(ba)^{m-1}b^{m-1+2t}.
```

Тогда $bxb=(ba)^m b^{m+2t}$.

Построим вывод $x$ из $T$ по индукции по $m$.

- **База $m=1$:** нужно $x=ab^{2t}$. Это выводится так:

```math
  T \Rightarrow aT \Rightarrow a(bTb) \Rightarrow a(bbTb b)\Rightarrow\cdots\Rightarrow ab^{2t}.
```

- **Переход:** предположим, что $x_m=a(ba)^{m-1}b^{m-1+2t}$ выводимо из $T$.
  Тогда

```math
  T \Rightarrow aT \Rightarrow abTb \Rightarrow ab\,x_m\,b = a(ba)^m b^{m+2t}.
```

  Значит, $x_{m+1}\in L_T$.

Следовательно, $x\in L_T$, и

```math
S \Rightarrow bTb \Rightarrow bxb = (ba)^m b^{m+2t},
```

то есть $w\in L\cap R$. Значит, $U\subseteq L\cap R$.

---

#### (⊆) Включение $L\cap R\subseteq U$

Пусть $w\in L\cap R$. Тогда

```math
w=(ba)^m b^k\quad(m\ge 1,\ k\ge 1),
```

и после последней буквы $a$ в $w$ стоят только $b$.

Слово $w\in L$ выводится как конкатенация блоков $b\,L_T\,b$. Рассмотрим **последний блок**, содержащий букву $a$. Все блоки после него не могут содержать $a$, то есть являются чисто $b$-словами.

Чисто $b$-слова из $L(S)$ имеют чётную длину:  
в $L_T$ число $b$ всегда чётно (база $0$, обёртка $bTb$ добавляет $2$), а блок $bwb$ добавляет ещё $2$. Значит, каждый блок содержит чётное число $b$, и их конкатенация тоже.

Поэтому хвост $b^k$ можно представить как $b^{k'}(bb)^s$ с некоторыми $s\ge 0$, $k'\ge 1$ и $k=k'+2s$ так, что

```math
w = u\,(bb)^s,\qquad u=(ba)^m b^{k'},
```

где $u\in L$ и после последней буквы $a$ в $u$ **нет** “отдельных” чисто-$b$ блоков, то есть $u$ выводится **одним** блоком $S\Rightarrow bTb$.

Значит $u=bxb$ для некоторого $x\in L_T$. Из равенства $u=(ba)^m b^{k'}$ получаем

```math
x = a(ba)^{m-1} b^{k'-1}.
```

Применим к $x$ процесс, обратный правилам $T$ (эквивалентный проверке принадлежности $L_T$):

1) если слово начинается с $a$, удаляем ведущую $a$;  
2) иначе, если начинается с $b$, то оно должно оканчиваться на $b$, и тогда удаляем первую и последнюю $b$.

Для $x=a(ba)^{m-1}b^{k'-1}$:

- удаляем ведущую $a$: получаем $(ba)^{m-1}b^{k'-1}$;
- затем $m-1$ раз удаляем крайние $b$, получаем $a\,b^{k'-m}$;
- удаляем ведущую $a$, остаётся $b^{k'-m}$.

Чтобы $x\in L_T$, остаток $b^{k'-m}$ должен принадлежать $L_T$. Но чисто $b$-слова в $L_T$ имеют вид $b^{2t}$ (ровно $t$ раз применить $T\to bTb$ к $\varepsilon$).  
Значит

```math
k'-m = 2t\ \text{для некоторого }t\ge 0
\quad\Rightarrow\quad
k' = m + 2t.
```

Тогда

```math
k = k'+2s = m + 2(t+s),
```

и

```math
w=(ba)^m b^{m+2(t+s)}\in U.
```

Значит, $L\cap R\subseteq U$, и в итоге $L\cap R = U$.

---

### 3.3. Нерегулярность $U$

Предположим противное: $U$ регулярный. Пусть $p$ — длина накачки.

Возьмём слово

```math
s=(ba)^p b^{p}\in U \quad (\text{случай }t=0).
```

По лемме о накачке $s=xyz$, где $|xy|\le p$, $|y|>0$ и для всех $i\ge 0$ выполнено $xy^i z\in U$.

Так как $|xy|\le p$, подслово $y$ лежит целиком внутри первых $p$ символов префикса $(ba)^p$, то есть накачка не затрагивает хвост $b^p$. Рассмотрим $s' = xy^2 z$. Хвост $b^p$ в $s'$ не изменился.

Два случая:

1) **$y$ содержит хотя бы одну букву $a$.** Тогда в $s'$ букв $a$ стало больше, чем $p$.  
   Но любое слово из $U$ имеет вид $(ba)^m b^{m+2t}$: число букв $a$ равно $m$, а длина конечного хвоста из $b$ равна $m+2t\ge m$.  
   В $s'$ длина хвоста равна $p$, значит число букв $a$ не может превышать $p$. Противоречие.

2) **$y$ не содержит $a$.** Тогда $y$ состоит только из $b$.  
   В $(ba)^p$ нет подслова $bb$. Накачка $y$ создаёт $bb$ внутри префикса до начала конечного хвоста, поэтому $s'\notin R$, а значит $s'\notin U\subseteq R$. Противоречие.

Получили противоречие с леммой о накачке. Следовательно, $U$ нерегулярен.

---

### 3.4. Нерегулярность $L$

Так как $R$ регулярный, а $L\cap R = U$ нерегулярен, язык $L$ не может быть регулярным:

```math
\boxed{\,L\ \text{не регулярный.}\,}
```

---

## Итог

1) $\boxed{L = (b\,L_T\,b)^+}$, где $L_T$ — наименьший язык, содержащий $\varepsilon$ и замкнутый относительно $w\mapsto aw$ и $w\mapsto bwb$.  
2) $\boxed{L\ \text{контекстно-свободный}}$ (предъявлена КС-грамматика).  
3) $\boxed{L\ \text{не регулярный}}$ (через пересечение с регулярным $R=(ba)^+b^+$).
